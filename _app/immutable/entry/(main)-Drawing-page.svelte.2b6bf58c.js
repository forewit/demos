var X=Object.defineProperty;var P=(t,s,a)=>s in t?X(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var r=(t,s,a)=>(P(t,typeof s!="symbol"?s+"":s,a),a);import{S as k,i as L,s as Y,k as C,l as D,m as _,h as g,n as T,b,I as u,o as H,w as M,a as S,y as R,D as $,c as A,z,A as O,g as W,d as q,B}from"../chunks/index.1c987778.js";const p=500,I=300,w=500,G=300;class N{constructor(){r(this,"isMoving",!1);r(this,"isLongclick",!1);r(this,"button",0);r(this,"lastX",0);r(this,"lastY",0);r(this,"consecutiveClicks",0);r(this,"lastMouseupTime",0);r(this,"activeElement",null);this.reset()}reset(){this.isMoving=!1,this.isLongclick=!1,this.button=0,this.lastX=0,this.lastY=0,this.consecutiveClicks=0,this.lastMouseupTime=0,this.activeElement=null}}class V{constructor(){r(this,"isDragging",!1);r(this,"isPinching",!1);r(this,"isLongpressed",!1);r(this,"consecutiveTaps",0);r(this,"lastTouchendTime",0);r(this,"lastCenterX",0);r(this,"lastCenterY",0);r(this,"identifier",0);r(this,"x",0);r(this,"y",0);r(this,"hypotenuse",0);r(this,"activeElement",null);this.reset()}reset(){this.isDragging=!1,this.isPinching=!1,this.isLongpressed=!1,this.consecutiveTaps=0,this.lastTouchendTime=0,this.lastCenterX=0,this.lastCenterY=0,this.identifier=0,this.x=0,this.y=0,this.hypotenuse=0,this.activeElement=null}}let y=[],n=new N,e=new V;const c=(t,s)=>{t!=null&&t.dispatchEvent(new CustomEvent("gesture",{detail:s,bubbles:!1,cancelable:!1}))},K=t=>{n.reset(),e.reset(),n.lastMouseupTime=Date.now(),window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",h),window.removeEventListener("touchmove",v),window.removeEventListener("touchend",d)},U=t=>{if(window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",h),window.removeEventListener("touchmove",v),window.removeEventListener("touchend",d),n.isMoving)if(n.isMoving=!1,n.isLongclick)n.isLongclick=!1,c(n.activeElement,{name:"longclick-drag-end",x:n.lastX,y:n.lastY});else switch(n.button){case 0:c(n.activeElement,{name:"left-click-drag-end",x:n.lastX,y:n.lastY});break;case 1:c(n.activeElement,{name:"middle-click-drag-end",x:n.lastX,y:n.lastY});break;case 2:c(n.activeElement,{name:"right-click-drag-end",x:n.lastX,y:n.lastY});break}n.isLongclick&&c(n.activeElement,{name:"longclick-release",x:n.lastX,y:n.lastY}),n.reset(),e.isDragging&&(e.isDragging=!1,e.isLongpressed?(e.isLongpressed=!1,c(e.activeElement,{name:"longpress-drag-end",x:e.lastCenterX,y:e.lastCenterY})):c(e.activeElement,{name:"touch-drag-end",x:e.lastCenterX,y:e.lastCenterY})),e.isLongpressed&&c(e.activeElement,{name:"longpress-release",x:e.lastCenterX,y:e.lastCenterY}),e.reset()},j=t=>{c(t.target,{name:"wheel",x:t.clientX,y:t.clientY,event:t}),t.preventDefault(),t.stopPropagation()},F=t=>{t.preventDefault(),t.stopPropagation()},J=t=>{document.activeElement!==t.target&&(window.addEventListener("mousemove",m),window.addEventListener("mouseup",h),n.activeElement=t.target,n.lastX=t.clientX,n.lastY=t.clientY,n.isMoving||(n.button=t.button),n.button===0&&window.setTimeout(()=>{Date.now()-n.lastMouseupTime>=w&&!n.isMoving&&(n.isLongclick=!0,c(n.activeElement,{name:"longclick",x:t.clientX,y:t.clientY}))},w),t.preventDefault(),t.stopPropagation())},m=t=>{if(t.movementX===0&&t.movementY===0)return;let s=t.clientX-n.lastX,a=t.clientY-n.lastY;if(!n.isMoving)if(n.isLongclick)c(n.activeElement,{name:"longclick-drag-start",x:t.clientX,y:t.clientY});else switch(n.button){case 0:c(n.activeElement,{name:"left-click-drag-start",x:t.clientX,y:t.clientY});break;case 1:c(n.activeElement,{name:"middle-click-drag-start",x:t.clientX,y:t.clientY});break;case 2:c(n.activeElement,{name:"right-click-drag-start",x:t.clientX,y:t.clientY});break}if(n.isMoving=!0,n.lastX=t.clientX,n.lastY=t.clientY,n.isLongclick)c(n.activeElement,{name:"longclick-dragging",x:t.clientX,y:t.clientY,dx:s,dy:a});else switch(n.button){case 0:c(n.activeElement,{name:"left-click-dragging",x:t.clientX,y:t.clientY,dx:s,dy:a});break;case 1:c(n.activeElement,{name:"middle-click-dragging",x:t.clientX,y:t.clientY,dx:s,dy:a});break;case 2:c(n.activeElement,{name:"right-click-dragging",x:t.clientX,y:t.clientY,dx:s,dy:a});break}},h=t=>{if(window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",h),n.lastMouseupTime=Date.now(),n.isMoving)if(n.isMoving=!1,n.isLongclick)n.isLongclick=!1,c(n.activeElement,{name:"longclick-drag-end",x:n.lastX,y:n.lastY});else switch(n.button){case 0:c(n.activeElement,{name:"left-click-drag-end",x:n.lastX,y:n.lastY});break;case 1:c(n.activeElement,{name:"middle-click-drag-end",x:n.lastX,y:n.lastY});break;case 2:c(n.activeElement,{name:"right-click-drag-end",x:n.lastX,y:n.lastY});break}else n.isLongclick||(t.button===2?c(n.activeElement,{name:"right-click",x:t.clientX,y:t.clientY}):t.button===1?c(n.activeElement,{name:"middle-click",x:t.clientX,y:t.clientY}):(n.consecutiveClicks===0&&c(n.activeElement,{name:"left-click",x:t.clientX,y:t.clientY}),n.consecutiveClicks++,window.setTimeout(()=>{n.consecutiveClicks>1&&c(n.activeElement,{name:"double-click",x:t.clientX,y:t.clientY}),n.consecutiveClicks=0},G)));n.isLongclick&&c(n.activeElement,{name:"longclick-release",x:t.clientX,y:t.clientY}),n.isLongclick=!1},Q=t=>{if(t.touches.length>1&&(t.preventDefault(),t.stopPropagation()),document.activeElement!==t.target){if(t.preventDefault(),t.stopPropagation(),t.touches.length>1){if(t.touches[0].identifier===e.identifier)return;e.isPinching=!0}window.addEventListener("touchmove",v,{passive:!1}),window.addEventListener("touchend",d),window.addEventListener("touchcancel",d),e.identifier=t.touches[0].identifier,e.x=t.touches[0].clientX,e.y=t.touches[0].clientY,e.activeElement=t.target,window.setTimeout(()=>{e.isPinching||e.isDragging||Date.now()-e.lastTouchendTime>=p&&(e.isDragging=!1,e.isPinching=!1,e.hypotenuse=null,e.isLongpressed=!0,c(e.activeElement,{name:"longpress",x:e.x,y:e.y}))},p)}},v=t=>{if(t.preventDefault(),t.stopPropagation(),e.isDragging){let s=e.x,a=e.y;e.x=t.touches[0].clientX,e.y=t.touches[0].clientY;let i=e.x-s,l=e.y-a;e.isLongpressed?c(e.activeElement,{name:"longpress-dragging",x:e.x,y:e.y,dx:i,dy:l}):c(e.activeElement,{name:"touch-dragging",x:e.x,y:e.y,dx:i,dy:l});return}else if(!e.isLongpressed&&(e.isPinching||t.touches.length>1)){e.x=t.touches[0].clientX,e.y=t.touches[0].clientY;let s={x:t.touches[1].clientX,y:t.touches[1].clientY},a={x:(e.x+s.x)/2,y:(e.y+s.y)/2},i=Math.hypot(e.x-s.x,e.y-s.y);e.hypotenuse===null&&(e.hypotenuse=i,e.lastCenterX=a.x,e.lastCenterY=a.y,c(e.activeElement,{name:"pinch-start",x:a.x,y:a.y})),e.isPinching=!0;let l=i/e.hypotenuse,o=a.x-e.lastCenterX,f=a.y-e.lastCenterY;c(e.activeElement,{name:"pinching",x:a.x,y:a.y,zoom:l,dx:o,dy:f}),e.hypotenuse=i,e.lastCenterX=a.x,e.lastCenterY=a.y;return}else e.isDragging=!0,e.isLongpressed?(c(e.activeElement,{name:"longpress-drag-start",x:e.x,y:e.y}),e.x=t.touches[0].clientX,e.y=t.touches[0].clientY,c(e.activeElement,{name:"longpress-dragging",x:e.x,y:e.y,dx:0,dy:0})):(c(e.activeElement,{name:"touch-drag-start",x:e.x,y:e.y}),e.x=t.touches[0].clientX,e.y=t.touches[0].clientY,c(e.activeElement,{name:"touch-dragging",x:e.x,y:e.y,dx:0,dy:0}))},d=t=>{e.isDragging&&t.touches.length>0&&t.touches[0].identifier===e.identifier||(e.lastTouchendTime=Date.now(),window.removeEventListener("touchmove",v),window.removeEventListener("touchend",d),window.removeEventListener("touchcancel",d),e.isDragging?(e.isDragging=!1,e.isLongpressed?(e.isLongpressed=!1,c(e.activeElement,{name:"longpress-drag-end",x:e.x,y:e.y})):c(e.activeElement,{name:"touch-drag-end",x:e.x,y:e.y})):e.isPinching?(e.isPinching=!1,e.hypotenuse=null,c(e.activeElement,{name:"pinch-end",x:e.lastCenterX,y:e.lastCenterY})):e.isLongpressed||(e.consecutiveTaps===0&&c(e.activeElement,{name:"tap",x:e.x,y:e.y}),e.consecutiveTaps++,window.setTimeout(()=>{e.consecutiveTaps>1&&c(e.activeElement,{name:"double-tap",x:e.x,y:e.y}),e.consecutiveTaps=0},I)),e.isLongpressed&&c(e.activeElement,{name:"longpress-release",x:e.x,y:e.y}),e.isLongpressed=!1)};function Z(...t){for(let s of t)y.findIndex(a=>a===s)===-1&&(y.length==0&&(window.addEventListener("blur",U),window.addEventListener("focus",K)),y.push(s),s.addEventListener("touchstart",Q,{passive:!1}),s.addEventListener("mousedown",J,{passive:!1}),s.addEventListener("contextmenu",F,{passive:!1}),s.addEventListener("wheel",j,{passive:!1}))}let E=function(t,s,a,i){var l=a-t,o=i-s;return Math.sqrt(l*l+o*o)};class ee{constructor(s,a){r(this,"resizeObserver",new ResizeObserver(this.resize.bind(this)));r(this,"elm");r(this,"ctx");r(this,"dragHandler");r(this,"startHandler");r(this,"lastPoint");r(this,"height");r(this,"width");r(this,"dpi");r(this,"drawRadius");r(this,"lineWidth");r(this,"lineCap");r(this,"strokeStyle");r(this,"lineDash");a||(a={}),this.lastPoint={x:0,y:0},this.height=0,this.width=0,this.dpi=window.devicePixelRatio,this.elm=s,this.ctx=this.elm.getContext("2d"),this.drawRadius=a.drawRadius?a.drawRadius:10,this.lineWidth=a.lineWidth?a.lineWidth:5,this.lineCap=a.lineCap?a.lineCap:"round",this.strokeStyle=a.strokeStyle?a.strokeStyle:"#000000",this.lineDash=a.lineDash?a.lineDash:[],this.dragHandler=this.dragHandle.bind(this),this.startHandler=this.startHandle.bind(this),this.resizeObserver.observe(this.elm);var i=this;Z(i.elm),i.elm.addEventListener("gesture",l=>{switch(l.detail.name){case"left-click-drag-start":case"touch-drag-start":i.startHandle(l.detail.x,l.detail.y);break;case"left-click-dragging":case"touch-dragging":i.dragHandle(l.detail.x,l.detail.y);break}}),i.resize()}screenToCanvas(s,a){let i=this.elm.getBoundingClientRect();return{x:(s+i.left)*this.dpi,y:(a-i.top)*this.dpi}}startHandle(s,a){var i=this;i.ctx.resetTransform(),i.ctx.clearRect(0,0,i.width,i.height),i.ctx.lineWidth=i.lineWidth,i.ctx.lineCap=i.lineCap,i.ctx.strokeStyle=i.strokeStyle,i.ctx.setLineDash(i.lineDash),i.ctx.beginPath(),i.lastPoint=i.screenToCanvas(s,a),i.ctx.moveTo(i.lastPoint.x,i.lastPoint.y)}dragHandle(s,a){var i=this;let l=i.screenToCanvas(s,a);if(i.drawRadius>0){if(E(l.x,l.y,i.lastPoint.x,i.lastPoint.y)<=i.drawRadius)return;let x=Math.sqrt(l.x*l.x+l.y*l.y-2*l.x*i.lastPoint.x+i.lastPoint.x*i.lastPoint.x-2*l.y*i.lastPoint.y+i.lastPoint.y*i.lastPoint.y);if(l={x:l.x+i.drawRadius*((i.lastPoint.x-l.x)/x),y:l.y+i.drawRadius*((i.lastPoint.y-l.y)/x)},E(i.lastPoint.x,i.lastPoint.y,l.x,l.y)<=.1)return}var o=(i.lastPoint.x+l.x)/2,f=(i.lastPoint.y+l.y)/2;i.ctx.quadraticCurveTo(i.lastPoint.x,i.lastPoint.y,o,f),i.lastPoint=l,i.ctx.stroke()}resize(){var s=this;console.log("resizing"),s.ctx.resetTransform(),s.dpi=window.devicePixelRatio;let a=+getComputedStyle(s.elm).getPropertyValue("height").slice(0,-2),i=+getComputedStyle(s.elm).getPropertyValue("width").slice(0,-2);s.height=a*s.dpi,s.width=i*s.dpi,s.elm.setAttribute("height",s.height.toString()),s.elm.setAttribute("width",s.width.toString())}}function te(t){let s;return{c(){s=C("canvas"),this.h()},l(a){s=D(a,"CANVAS",{class:!0}),_(s).forEach(g),this.h()},h(){T(s,"class","svelte-cff504")},m(a,i){b(a,s,i),t[1](s)},p:u,i:u,o:u,d(a){a&&g(s),t[1](null)}}}function ne(t,s,a){let i;H(()=>{new ee(i)});function l(o){M[o?"unshift":"push"](()=>{i=o,a(0,i)})}return[i,l]}class ie extends k{constructor(s){super(),L(this,s,ne,te,Y,{})}}function se(t){let s,a,i;return a=new ie({}),{c(){s=S(),R(a.$$.fragment),this.h()},l(l){$("svelte-9tg5sj",document.head).forEach(g),s=A(l),z(a.$$.fragment,l),this.h()},h(){document.title="Drawing"},m(l,o){b(l,s,o),O(a,l,o),i=!0},p:u,i(l){i||(W(a.$$.fragment,l),i=!0)},o(l){q(a.$$.fragment,l),i=!1},d(l){l&&g(s),B(a,l)}}}class re extends k{constructor(s){super(),L(this,s,null,se,Y,{})}}export{re as default};
